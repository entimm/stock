{% extends '_layout.html' %}
{% block head %}
  <title>A股龙头趋势图 - {{ ma }}</title>
  <style>
    #chart {
      width: 100%;
      height: 100%;
    }

    #fixed-links1 {
      position: absolute;
      top: 0;
      right: 0;
      margin: 20px 40px;
      z-index: 99;
    }

    #fixed-links2 {
      position: absolute;
      top: 50px;
      right: 0;
      margin: 20px 40px;
      z-index: 99;
    }

    #fixed-links3 {
      position: absolute;
      top: 100px;
      right: 0;
      margin: 20px 40px;
      z-index: 99;
    }

    #fixed-links4 {
      position: absolute;
      top: 150px;
      right: 0;
      margin: 20px 40px;
      z-index: 99;
    }

    .highlight {
      color: #FF5733;
      font-weight: bold;
      font-size: 20px;
      text-decoration: underline;
    }
  </style>
{% endblock %}
{% block content %}
  <div id="fixed-links1">
    {% for value in ma_list %}
      <a href="?ma={{ value }}&year={{ year }}&line_id={{ line_id }}&direction={{ direction }}" {% if value == ma %}class="highlight"{% endif %}>{{ value }}</a>
    {% endfor %}
  </div>
  <div id="fixed-links2">
    {% for value in year_list %}
      <a href="?ma={{ ma }}&year={{ value }}&line_id={{ line_id }}&direction={{ direction }}" {% if value == year %}class="highlight"{% endif %}>{{ value }}</a>
    {% endfor %}
  </div>
  <div id="fixed-links3">
    {% for value in line_list %}
      <a href="?ma={{ ma }}&year={{ year }}&line_id={{ loop.index0 }}&direction={{ direction }}" {% if line_id == loop.index0 %}class="highlight"{% endif %}>线{{ loop.index0 }}</a>
    {% endfor %}
  </div>
  <div id="fixed-links4">
    {% for key, value in direction_list.items() %}
      <a href="?ma={{ ma }}&year={{ year }}&line_id={{ key }}&direction={{ key }}" {% if direction == key %}class="highlight"{% endif %}>{{ value['name'] }}</a>
    {% endfor %}
  </div>
  <div style="clear: both;"></div>

  <div id="chart"></div>
{% endblock %}
{% block footer %}
  <script src="/static/third/echarts.min.js"></script>
  <script>
    let rows = {{ rows | tojson }};
    rows = rows.map(v => "NO." + v);
    let dataName = {{ data['name'] | tojson }};
    let dataValue = {{ data['value'] | tojson }};

    // 创建数据密度图的配置
    let chartConfig = {
      color: [
        "#FF33EC",
        "#FF5733",
        "#3357FF",
        "#00FFFF",
        "#008000",
        "#FFA500",
        "#33FF57",
        "#808080",
        "#2F80ED",
        "#EB5757",
        "#27AE60",
        "#F2994A",
        "#9B51E0",
        "#A0522D",
        "#2D9CDB",
        "#FF6B81",
        "#00A8FF",
        "#00D8D0",
      ],
      legend: {
        data: rows
      },
      xAxis: {
        type: 'category',
        boundaryGap: false,
        data: Object.keys(dataValue) // 使用年份和月份组合作为x轴数据
      },
      yAxis: {
        type: 'value',
        interval: 20,
      },
      dataZoom: [
        {
          type: 'inside',
          start: 0,
          end: 9999
        },
        {
          start: 0,
          end: 9999
        }
      ],
      grid: {
        left: '1%',
        right: '1%',
        containLabel: true
      },
      series: [],
      tooltip: {
        stack: 'Total',
        trigger: 'axis',
        axisPointer: {
          type: 'cross'
        },
        formatter: function (params) {
          return params.map(
            item => (item.marker + '<span style="display:inline-block;width:60px">' + item.seriesName + '</span>' + '<span style="display:inline-block;width:50px">' + item.value + '</span>' + dataName[item.name][item.seriesIndex])
          ).join('<br/>');
        },
      }
    };

    // 初始化图表并绘制
    let chart = echarts.init(document.getElementById('chart'));
    // 准备 series 数据
    chartConfig.series = Object.keys(rows).map(key => ({
      name: rows[key],
      type: 'line',
      data: Object.values(dataValue).map(item => item[key]),
      showSymbol: false,
      smooth: 0.3,
      emphasis: {
        focus: 'series',
        lineStyle: {
          width: 2,
        },
      },
      blur: {
        lineStyle: {
          opacity: 0.3,
        }
      },
      lineStyle: {
        width: 2,
      },
    }));
    chart.setOption(chartConfig);
    chart.setOption(chartConfig);
    window.addEventListener('resize', function () {
      chart.resize();
    });
  </script>
{% endblock %}