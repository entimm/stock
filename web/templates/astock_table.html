<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个股趋势涨幅榜</title>
    <style>
        table tr:nth-child(11) {
          border-bottom: 4px solid #FF0000;
        }
        table tr:nth-child(21) {
          border-bottom: 4px solid #FF4500;
        }
        table tr:nth-child(31) {
          border-bottom: 4px solid #FFA500;
        }
        table tr:nth-child(41) {
          border-bottom: 4px solid #FFD700;
        }
        table tr:nth-child(51) {
          border-bottom: 4px solid #FFFF00;
        }
        table tr:nth-child(61) {
          border-bottom: 4px solid #ADFF2F;
        }
        table tr:nth-child(71) {
          border-bottom: 4px solid #7FFF00;
        }
        table tr:nth-child(81) {
          border-bottom: 4px solid #00FF00;
        }
        table tr:nth-child(91) {
          border-bottom: 4px solid #008000;
        }
        .tooltip-big {;
          width: 1640px;
          height: 340px;
        }
    </style>
    <link rel="stylesheet" href="static/table.css">
</head>
<body>
    <div class="fixed-links">
        {% for value in ma_list %}
            <a href="?ma={{value}}&year={{year}}&direction={{direction}}" {% if value == ma %}class="highlight"{% endif %}>{{value}}</a>
        {% endfor %}
        {% for value in year_list %}
            <a href="?ma={{ma}}&year={{value}}&direction={{direction}}" {% if value == year %}class="highlight"{% endif %}>{{value}}</a>
        {% endfor %}
        {% for key, value in direction_list.items() %}
            <a href="?ma={{ma}}&year={{year}}&direction={{key}}" {% if direction == key %}class="highlight"{% endif %}>{{value['name']}}</a>
        {% endfor %}
    </div>

    <dialog id="myDialog" style="overflow: hidden;">
        <span class="close-button" onclick="closeDialog()">×</span>
        <iframe id="iframeContent" style="width: 100%; height: 100%; border: none;"></iframe>
    </dialog>

    <div id="grid-container">
        <table id="grid"></table>
        <div id="tooltip" class="tooltip-big" style="display:none;position: fixed;"></div>
    </div>
    <script type="text/javascript" src="/static/table.js"></script>
    <script>
        let data = {{ data | safe }};
        const KLINE_PERIOD = 'F5';

        renderGrid(data);

        function getExchangeCode(symbol) {
            let exchangeCode = symbol.slice(0, 2);

            if (exchangeCode === "60" || exchangeCode === "68") {
                return `sh${symbol}`;
            } else if (exchangeCode === "00" || exchangeCode === "30") {
                return `sz${symbol}`;
            } else if (exchangeCode === "43" || exchangeCode === "83" || exchangeCode === "87") {
                return `bj${symbol}`;
            } else {
                return symbol;
            }
        }

        function show_tooltip(cell) {
          let symbol = cell.getAttribute('symbol');
          let code = getExchangeCode(symbol)
          tooltip.textContent = cell.getAttribute('v');

          tooltip.appendChild(document.createElement('br'));

          let img1 = document.createElement("img");
          img1.src = `https://image2.sinajs.cn/newchart/min/n/${code}.gif`;
          tooltip.appendChild(img1);
          let img2 = document.createElement("img");
          img2.src = `https://image2.sinajs.cn/newchart/daily/n/${code}.gif`;
          tooltip.appendChild(img2);
          let img3 = document.createElement("img");
          img3.src = `https://image2.sinajs.cn/newchart/weekly/n/${code}.gif`;
          tooltip.appendChild(img3);

          // 计算tooltip的位置

          // 获取屏幕的宽度和高度
          var screenWidth = window.innerWidth;
          var screenHeight = window.innerHeight;

        if (event.clientY <= screenHeight / 2) {
          // 右下角
          tooltip.style.left = screenWidth - tooltip.offsetWidth + 'px';
          tooltip.style.top = screenHeight - tooltip.offsetHeight + 'px';
        } else {
          // 右上角
          tooltip.style.left = screenWidth - tooltip.offsetWidth + 'px';
          tooltip.style.top = '0px';

        }

          tooltip.style.display = 'block';
        }

        function addDotClass(element, price) {
            const dotClasses = [
                { 'condition': price >= 15, 'className': 'red-dot3' },
                { 'condition': price >= 9.6, 'className': 'red-dot2' },
                { 'condition': price >= 5, 'className': 'red-dot1' },
                { 'condition': price <= -5, 'className': 'green-dot1' },
                { 'condition': price <= -9, 'className': 'green-dot2' },
                { 'condition': price <= -15, 'className': 'green-dot3' },
            ];
            dotClasses.forEach((dotClass) => {
                if (dotClass.condition) {
                    element.classList.add('dot', dotClass.className);
                }
            });
        }
    </script>
</body>
</html>